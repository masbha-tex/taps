<?xml version="1.0" encoding="utf-8"?>
<odoo>


    <record id="res_partner_view_buttons_inherit" model="ir.ui.view">
            <field name="name">res.partner.view.buttons.inherit</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form" />
            <field name="priority" eval="3"/>
            <field name="groups_id" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
            <field name="arch" type="xml">
                
                <div name="button_box" position="inside">
                    <button class="oe_stat_button" type="object" name="action_view_ccr"
                        groups="sales_team.group_sale_salesman"
                        icon="fa-envelope-open-o">
                        <field string="CCR" name="ccr_count" widget="statinfo"/>
                    </button>
                </div>
                    
                
                
                <!-- <page name="internal_notes" position="inside">
                    <group colspan="2" col="2" groups="sale.group_warning_sale">
                        <separator string="Warning on the Sales Order" colspan="4" />
                            <field name="sale_warn" nolabel="1" />
                            <field name="sale_warn_msg" colspan="3" nolabel="1"
                                    attrs="{'required':[('sale_warn', '!=', False), ('sale_warn','!=','no-message')], 'invisible':[('sale_warn','in',(False,'no-message'))]}"/>
                    </group>
                </page> -->
            </field>
        </record>
        <record model="ir.rule" id="record_ccr_multi_company_rule">
            <field name="name">CCR</field>
            <field name="model_id" ref="model_sale_ccr"/>
            <field name="global" eval="True"/>
            <field name="domain_force">
               [('company_id', 'in', company_ids)]
            </field>
        </record>
    <record id="view_sale_ccr__typetree" model="ir.ui.view">
            <field name="name">sale.ccr.type.tree</field>
            <field name="model">sale.ccr.type</field>
            <field name="arch" type="xml">
                <tree string="CCR TYPE TREE" multi_edit="1" sample="1">
                    <field name="name"/>
                </tree>
            </field>
    </record>

    <record id="view_sale_ccr_tree" model="ir.ui.view">
            <field name="name">sale.ccr.tree</field>
            <field name="model">sale.ccr</field>
            <field name="arch" type="xml">
                <tree string="CCR TREE" multi_edit="1" sample="1">
                    <field name="name"/>
                    <field name="oa_number"/>
                    <field name="customer"/>
                    <field name="company_id" groups="base.group_multi_company" optional="show" readonly="1"/>
                </tree>
            </field>
    </record>
    <record id="action_sale_ccr_type" model="ir.actions.act_window">
            <field name="name">CCR TYPE</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.ccr.type</field>
            <field name="view_mode">tree,form</field>
            <!-- <field name="search_view_id" ref="sale_order_view_search_inherit_sale"/> -->
            <field name="context">{}</field>
            <!-- <field name="domain">[('state', 'not in', ('draft', 'sent', 'cancel'))]</field> -->
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new CCR TYPE, the first step of a new CCR TYPE!
                </p>
            </field>
        </record>
    <record id="view_sale_ccr_form" model="ir.ui.view">
            <field name="name">sale.ccr.form</field>
            <field name="model">sale.ccr</field>
            <field name="arch" type="xml">
                <form string="CCR FORM" multi_edit="1" sample="1">
                    <header>
                        <button name="action_justify" type="object" string="Justify"/>
                        <button name="action_notjustify" type="object" string="Not Justify" context="{'active_id':id}"/>
                        <button name="action_take" type="object" string="Take Action" context="{'active_id':id}"/>
                        <button name="action_cancel" type="object" string="Cancel"/>
                        <button name="action_draft" type="object" string="Set To Draft"  attrs="{'invisible': [('states', 'not in', ['cancel'])]}"/>
                        <button name="action_close" type="object" string="Close" attrs="{'invisible': [('states', 'in', ['done' ,'cancel'])]}"/>
                        <!-- <button name="action_draft" states="cancel" type="object" string="Set to Draft"/> -->
                        
                        <field name="states" widget="statusbar" statusbar_visible="draft,done"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" />
                            </h1>
                        </div>
                        <br/>
                        <div class="oe_title">
                                <h2 style="color: #E54F6D">DETAILS INFORMATION</h2>
                        </div>
                        <group>
                        
                        <group>
                            <field name="oa_number" domain="[('sales_type','=', 'oa')]"/>
                            <field name="customer"/>
                            <field name="buyer"/>
                            <field name="pi_number"/>
                            <field name="order_quantity"/>
                            <field name="rejected_quantity"/>
                            <field name="sale_order_line_id" invisible="1"/>
                            <field name="fg_product"/>
                            <field name="finish"/>
                            
                        </group>
                        <group>
                            <field name="ccr_type"/>
                            <field name="complaint"/>
                            <field name="department_id" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit':True, 'no_open': True}"/>
                            <field name="replacement_quantity"/>
                            <field name="invoice_reference"/>
                            <field name="report_date"/>
                            <field name="analysis_activity"/>
                        </group>
                            
                        </group>
                        <div class="oe_title">
                                <h2 style="color: #E54F6D">SALES</h2>
                        </div>
                        <group>
                            <group>
                                <field name="sale_representative"/>
                                <field name="team"/>
                            </group>
                            <group>
                                <field name="team_leader"/>
                            </group>
                        </group>
                        <div class="oe_title" attrs="{'invisible': [('states', 'not in', ['just'])]}">
                                <h2 style="color: #E54F6D">CAPA</h2>
                        </div>
                        <group>
                            
                            <group attrs="{'invisible': [('states', 'not in', ['just'])]}">
                                <field name="corrective_action"/>
                                <field name="cap_closing_date"/>
                            </group>
                            <group attrs="{'invisible': [('states', 'not in', ['just'])]}">
                                <field name="preventive_action"/>
                            </group>
                            
                        </group>
                        <div class="oe_title">
                                <h2 style="color: #E54F6D">JUSTIFICATION</h2>
                        </div>
                        <group>
                            <field name="justification" widget="radio" nolabel="1"/>
                            <field name="reason"/>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
    </record>
    <record id="action_sale_ccr" model="ir.actions.act_window">
            <field name="name">CCR</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.ccr</field>
            <field name="view_mode">tree,kanban,form</field>
            <!-- <field name="search_view_id" ref="sale_order_view_search_inherit_sale"/> -->
            <field name="context">{}</field>
            <!-- <field name="domain">[('state', 'not in', ('draft', 'sent', 'cancel'))]</field> -->
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new CCR, the first step of a new CCR!
                </p>
            </field>
        </record>

    
    <menuitem id="sale_ccr_view_menu"
            name="CCR"
            parent="sale.sale_menu_root"
            sequence="6"/>
    <menuitem id="sale_ccr_view_new_menu"
            name="NEW CCR"
            parent="taps_sale.sale_ccr_view_menu"
            action = "action_sale_ccr"
            sequence="7"/>



    <menuitem
        id="menu_sale_ccr"
        name="CCR"
        parent="sale.menu_sales_config"
        sequence="25"/>
    <menuitem
        id="menu_sale_ccr_type"
        name="CCR TYPE"
        parent="taps_sale.menu_sale_ccr"
        action="taps_sale.action_sale_ccr_type"
        sequence="26"/>
</odoo>